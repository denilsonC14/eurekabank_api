<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             xmlns:sensors="clr-namespace:Microsoft.Maui.Devices.Sensors;assembly=Microsoft.Maui.Essentials"
             xmlns:viewmodels="clr-namespace:Eurekabank_Maui.ViewModels"
             x:Class="Eurekabank_Maui.Views.MapaSucursalesPage"
             x:DataType="viewmodels:MapaSucursalesViewModel"
             Title="ðŸ—ºï¸ Mapa de Sucursales">

    <Grid RowDefinitions="Auto,Auto,*,Auto" RowSpacing="0">

        <!-- Header con controles -->
        <Frame Grid.Row="0"
               CornerRadius="0"
               Padding="15"
               BackgroundColor="#3498db"
               HasShadow="True">
            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                <Label Grid.Column="0"
                       Text="{Binding CantidadSucursales, StringFormat='ðŸ“ {0} sucursales'}"
                       TextColor="White"
                       FontSize="16"
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>

                <Button Grid.Column="1"
                        Text="ðŸ“"
                        Command="{Binding CentrarEnMiUbicacionCommand}"
                        BackgroundColor="White"
                        TextColor="#3498db"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontSize="20"
                        ToolTipProperties.Text="Centrar en mi ubicaciÃ³n"/>

                <Button Grid.Column="2"
                        Text="ðŸ”„"
                        Command="{Binding RecargarSucursalesCommand}"
                        BackgroundColor="White"
                        TextColor="#3498db"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontSize="20"
                        ToolTipProperties.Text="Recargar sucursales"/>
            </Grid>
        </Frame>

        <!-- InformaciÃ³n de mi ubicaciÃ³n -->
        <Frame Grid.Row="1"
               Padding="12"
               Margin="10,5"
               BackgroundColor="#27ae60"
               CornerRadius="10"
               HasShadow="True"
               IsVisible="{Binding TengoUbicacion}">
            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*" RowSpacing="5" ColumnSpacing="10">
                <Label Grid.Row="0" Grid.Column="0"
                       Text="ðŸ“"
                       FontSize="24"
                       VerticalOptions="Center"
                       Grid.RowSpan="2"/>

                <Label Grid.Row="0" Grid.Column="1"
                       Text="Mi UbicaciÃ³n"
                       TextColor="White"
                       FontSize="14"
                       FontAttributes="Bold"/>

                <Label Grid.Row="1" Grid.Column="1"
                       TextColor="White"
                       FontSize="12">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Lat: "/>
                            <Span Text="{Binding MiLatitud, StringFormat='{0:F6}'}" FontAttributes="Bold"/>
                            <Span Text=" | Lng: "/>
                            <Span Text="{Binding MiLongitud, StringFormat='{0:F6}'}" FontAttributes="Bold"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </Grid>
        </Frame>

        <!-- Mapa -->
        <maps:Map x:Name="mapa"
                  Grid.Row="2"
                  IsShowingUser="True"
                  MapType="Street">

            <!-- El mapa se poblarÃ¡ desde el cÃ³digo -->
        </maps:Map>

        <!-- Info de sucursal seleccionada -->
        <Frame Grid.Row="3"
               IsVisible="{Binding SucursalSeleccionada, Converter={StaticResource IsNotNullConverter}}"
               CornerRadius="15,15,0,0"
               Padding="20"
               BackgroundColor="White"
               HasShadow="True"
               Margin="0,-10,0,0">

            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="10">

                <!-- Nombre -->
                <Label Grid.Row="0"
                       Text="{Binding SucursalSeleccionada.Nombre}"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#2c3e50"/>

                <!-- Ciudad -->
                <HorizontalStackLayout Grid.Row="1" Spacing="5">
                    <Label Text="ðŸ™ï¸" FontSize="16"/>
                    <Label Text="{Binding SucursalSeleccionada.Ciudad}"
                           FontSize="16"
                           TextColor="#7f8c8d"/>
                </HorizontalStackLayout>

                <!-- DirecciÃ³n -->
                <HorizontalStackLayout Grid.Row="2" Spacing="5">
                    <Label Text="ðŸ“" FontSize="16"/>
                    <Label Text="{Binding SucursalSeleccionada.Direccion}"
                           FontSize="14"
                           TextColor="#7f8c8d"
                           LineBreakMode="WordWrap"/>
                </HorizontalStackLayout>

                <!-- TelÃ©fono y Email -->
                <HorizontalStackLayout Grid.Row="3" Spacing="15">
                    <HorizontalStackLayout Spacing="5">
                        <Label Text="ðŸ“ž" FontSize="16"/>
                        <Label Text="{Binding SucursalSeleccionada.Telefono}"
                               FontSize="14"
                               TextColor="#7f8c8d"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="5">
                        <Label Text="âœ‰ï¸" FontSize="16"/>
                        <Label Text="{Binding SucursalSeleccionada.Email}"
                               FontSize="14"
                               TextColor="#7f8c8d"/>
                    </HorizontalStackLayout>
                </HorizontalStackLayout>

                <!-- BotÃ³n de navegaciÃ³n -->
                <Button Grid.Row="4"
                        Text="ðŸ§­ CÃ³mo llegar"
                        Command="{Binding AbrirNavegacionCommand}"
                        BackgroundColor="#3498db"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        FontSize="16"
                        FontAttributes="Bold"
                        Margin="0,10,0,0"/>
            </Grid>
        </Frame>

        <!-- Indicador de carga -->
        <ActivityIndicator Grid.Row="2"
                          IsRunning="{Binding EstaCargando}"
                          IsVisible="{Binding EstaCargando}"
                          Color="#3498db"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"
                          WidthRequest="50"
                          HeightRequest="50"/>
    </Grid>

</ContentPage>
